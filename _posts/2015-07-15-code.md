---
layout: post
title: Land surface temperature time series analysis
date: 2015-07-15 15:09:00
description: an example of a blog post with some code
tags: formatting code
categories: sample-posts
featured: true
---

This theme implements a built-in Jekyll feature, the use of Rouge, for syntax highlighting.
It supports more than 100 languages.
This example is in C++.
All you have to do is wrap your code in markdown code tags:

```javascript
// This is an example JavaScript code block
var cities = ee.FeatureCollection('projects/ee-tsejustin-geo4dev/assets/UScities');
var aoi = cities.filterMetadata('NAME', 'equals', 'Stockton');
Map.addLayer(aoi,'', 'aoi');
Map.centerObject(aoi, 10);
```

```javascript
var YEAR_RANGE = ee.Filter.calendarRange(2013, 2023, 'year');

//Import the LST image collection
var LST = ee.ImageCollection("MODIS/061/MOD11A1")
                  .filter(YEAR_RANGE)
                  .select('LST_Day_1km','LST_Night_1km','QC_Day','QC_Night')
                  .filterBounds(aoi);

//kelvin to celcius
function LSTScaleFactors(image) {
  var thermalBands = image.select('LST_Day_1km','LST_Night_1km').multiply(0.02)
  .subtract(273.15); 
  return image.addBands(thermalBands, null, true);

var LST_scaled = LST.map(LSTScaleFactors);
}
```
Create a bitmask function and apply it.

```javascript
var bitwiseExtract = function(input, fromBit, toBit) {
  var maskSize = ee.Number(1).add(toBit).subtract(fromBit)
  var mask = ee.Number(1).leftShift(maskSize).subtract(1)
  return input.rightShift(fromBit).bitwiseAnd(mask)
}

// Apply QA mask to both LST Day and LST Night
var applyQaMask = function(image) {
  var lstDay = image.select('LST_Day_1km');
  var qcDay = image.select('QC_Day');
  var lstNight = image.select('LST_Night_1km');
  var qcNight = image.select('QC_Night');

  // Apply masks for LST Day
  var qaMaskDay = bitwiseExtract(qcDay, 0, 1).lte(1);
  var dataQualityMaskDay = bitwiseExtract(qcDay, 2, 3).eq(0);
  var lstErrorMaskDay = bitwiseExtract(qcDay, 6, 7).eq(0);
  var maskDay = qaMaskDay.and(dataQualityMaskDay).and(lstErrorMaskDay);
  var lstDayMasked = lstDay.updateMask(maskDay);

  // Apply masks for LST Night
  var qaMaskNight = bitwiseExtract(qcNight, 0, 1).lte(1);
  var dataQualityMaskNight = bitwiseExtract(qcNight, 2, 3).eq(0);
  var lstErrorMaskNight = bitwiseExtract(qcNight, 6, 7).eq(0);
  var maskNight = qaMaskNight.and(dataQualityMaskNight).and(lstErrorMaskNight);
  var lstNightMasked = lstNight.updateMask(maskNight);

  // Add the masked bands back to the image
  return image.addBands([lstDayMasked.rename('LST_Day_Masked'), lstNightMasked.rename('LST_Night_Masked')], null, true);
}

var LST_Masked = LST_scaled.map(applyQaMask);
```
