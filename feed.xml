<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.3.3">Jekyll</generator><link href="https://jtin25.github.io/feed.xml" rel="self" type="application/atom+xml"/><link href="https://jtin25.github.io/" rel="alternate" type="text/html" hreflang="en"/><updated>2025-02-09T07:37:36+00:00</updated><id>https://jtin25.github.io/feed.xml</id><title type="html">Justin Tse</title><subtitle>Justin Tse&apos;s academic website. </subtitle><entry><title type="html">Land Surface Temperature Time Series Analysis</title><link href="https://jtin25.github.io/blog/2024/LST-timeSeries/" rel="alternate" type="text/html" title="Land Surface Temperature Time Series Analysis"/><published>2024-08-05T15:09:00+00:00</published><updated>2024-08-05T15:09:00+00:00</updated><id>https://jtin25.github.io/blog/2024/LST-timeSeries</id><content type="html" xml:base="https://jtin25.github.io/blog/2024/LST-timeSeries/"><![CDATA[<p>Time series analysis is a key technique in remote sensing for understanding temporal changes in the Earthâ€™s surface and atmosphere. In this tutorial, I will demonstrate its application in monitoring surface heat to analyze oscillations and seasonal variations in daytime and nighttime land surface temperature using MODIS satellite products.</p> <h3 id="setting-up-context">Setting Up Context</h3> <p>To begin, we define our area of interest and the timeframe for analysis. For this example, we focus on the city limits of Stockton over a 10-year period, from 2013 to 2023.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//import aoi from assets</span>
<span class="kd">var</span> <span class="nx">cities</span> <span class="o">=</span> <span class="nx">ee</span><span class="p">.</span><span class="nc">FeatureCollection</span><span class="p">(</span><span class="dl">'</span><span class="s1">projects/ee-tsejustin-geo4dev/assets/UScities</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">aoi</span> <span class="o">=</span> <span class="nx">cities</span><span class="p">.</span><span class="nf">filterMetadata</span><span class="p">(</span><span class="dl">'</span><span class="s1">NAME</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">equals</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Stockton</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">YEAR_RANGE</span> <span class="o">=</span> <span class="nx">ee</span><span class="p">.</span><span class="nx">Filter</span><span class="p">.</span><span class="nf">calendarRange</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">2023</span><span class="p">,</span> <span class="dl">'</span><span class="s1">year</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">//add the aoi to your map</span>
<span class="nb">Map</span><span class="p">.</span><span class="nf">addLayer</span><span class="p">(</span><span class="nx">aoi</span><span class="p">,</span><span class="dl">''</span><span class="p">,</span> <span class="dl">'</span><span class="s1">aoi</span><span class="dl">'</span><span class="p">);</span>
<span class="nb">Map</span><span class="p">.</span><span class="nf">centerObject</span><span class="p">(</span><span class="nx">aoi</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</code></pre></div></div> <h3 id="loading-and-rescaling-collection">Loading and Rescaling Collection</h3> <p>We use the MODIS Terra Land Surface Temperature and Emissivity product, which offers high temporal resolution (daily data) and includes both daytime and nighttime surface temperature measurements. Before conducting any analysis, it is crucial to apply the appropriate scale factor to the data, making the values comprehensible and comparable. In this case, the scale factor is 0.02, which converts the temperature data from its original unit to Kelvin. Subsequently, we subtract a constant to convert the temperature from Kelvin to Celsius. Detailed information about the band descriptions can be found in the GGE data catalog.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//Import the LST image collection</span>
<span class="kd">var</span> <span class="nx">LST</span> <span class="o">=</span> <span class="nx">ee</span><span class="p">.</span><span class="nc">ImageCollection</span><span class="p">(</span><span class="dl">"</span><span class="s2">MODIS/061/MOD11A1</span><span class="dl">"</span><span class="p">)</span>
                  <span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="nx">YEAR_RANGE</span><span class="p">)</span>
                  <span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">LST_Day_1km</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">LST_Night_1km</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">QC_Day</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">QC_Night</span><span class="dl">'</span><span class="p">)</span>
                  <span class="p">.</span><span class="nf">filterBounds</span><span class="p">(</span><span class="nx">aoi</span><span class="p">);</span>

<span class="c1">//kelvin to celcius</span>
<span class="kd">function</span> <span class="nf">LSTScaleFactors</span><span class="p">(</span><span class="nx">image</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">thermalBands</span> <span class="o">=</span> <span class="nx">image</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">LST_Day_1km</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">LST_Night_1km</span><span class="dl">'</span><span class="p">).</span><span class="nf">multiply</span><span class="p">(</span><span class="mf">0.02</span><span class="p">)</span>
  <span class="p">.</span><span class="nf">subtract</span><span class="p">(</span><span class="mf">273.15</span><span class="p">);</span> 
  <span class="k">return</span> <span class="nx">image</span><span class="p">.</span><span class="nf">addBands</span><span class="p">(</span><span class="nx">thermalBands</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">LST_scaled</span> <span class="o">=</span> <span class="nx">LST</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="nx">LSTScaleFactors</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="applying-bitmask">Applying Bitmask</h3> <p>To enhance the accuracy and robustness of the analysis, we employ a bitmask function provided by Spatial Thoughts to filter out low-quality pixels. This step helps in mitigating the impact of data anomalies. However, since we will be using the mean value of each image for plotting the time series, this step may be optional as averaging can naturally reduce the influence of outliers. The original blog can be found here: <a href="https://spatialthoughts.com/2021/08/19/qa-bands-bitmasks-gee/">https://spatialthoughts.com/2021/08/19/qa-bands-bitmasks-gee/</a>.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">bitwiseExtract</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">fromBit</span><span class="p">,</span> <span class="nx">toBit</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">maskSize</span> <span class="o">=</span> <span class="nx">ee</span><span class="p">.</span><span class="nc">Number</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">add</span><span class="p">(</span><span class="nx">toBit</span><span class="p">).</span><span class="nf">subtract</span><span class="p">(</span><span class="nx">fromBit</span><span class="p">)</span>
  <span class="kd">var</span> <span class="nx">mask</span> <span class="o">=</span> <span class="nx">ee</span><span class="p">.</span><span class="nc">Number</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">leftShift</span><span class="p">(</span><span class="nx">maskSize</span><span class="p">).</span><span class="nf">subtract</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">input</span><span class="p">.</span><span class="nf">rightShift</span><span class="p">(</span><span class="nx">fromBit</span><span class="p">).</span><span class="nf">bitwiseAnd</span><span class="p">(</span><span class="nx">mask</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Apply QA mask to both LST Day and LST Night</span>
<span class="kd">var</span> <span class="nx">applyQaMask</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">image</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">lstDay</span> <span class="o">=</span> <span class="nx">image</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">LST_Day_1km</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">qcDay</span> <span class="o">=</span> <span class="nx">image</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">QC_Day</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">lstNight</span> <span class="o">=</span> <span class="nx">image</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">LST_Night_1km</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">qcNight</span> <span class="o">=</span> <span class="nx">image</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">QC_Night</span><span class="dl">'</span><span class="p">);</span>

  <span class="c1">// Apply masks for LST Day</span>
  <span class="kd">var</span> <span class="nx">qaMaskDay</span> <span class="o">=</span> <span class="nf">bitwiseExtract</span><span class="p">(</span><span class="nx">qcDay</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nf">lte</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">dataQualityMaskDay</span> <span class="o">=</span> <span class="nf">bitwiseExtract</span><span class="p">(</span><span class="nx">qcDay</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">).</span><span class="nf">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">lstErrorMaskDay</span> <span class="o">=</span> <span class="nf">bitwiseExtract</span><span class="p">(</span><span class="nx">qcDay</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">).</span><span class="nf">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">maskDay</span> <span class="o">=</span> <span class="nx">qaMaskDay</span><span class="p">.</span><span class="nf">and</span><span class="p">(</span><span class="nx">dataQualityMaskDay</span><span class="p">).</span><span class="nf">and</span><span class="p">(</span><span class="nx">lstErrorMaskDay</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">lstDayMasked</span> <span class="o">=</span> <span class="nx">lstDay</span><span class="p">.</span><span class="nf">updateMask</span><span class="p">(</span><span class="nx">maskDay</span><span class="p">);</span>

  <span class="c1">// Apply masks for LST Night</span>
  <span class="kd">var</span> <span class="nx">qaMaskNight</span> <span class="o">=</span> <span class="nf">bitwiseExtract</span><span class="p">(</span><span class="nx">qcNight</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nf">lte</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">dataQualityMaskNight</span> <span class="o">=</span> <span class="nf">bitwiseExtract</span><span class="p">(</span><span class="nx">qcNight</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">).</span><span class="nf">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">lstErrorMaskNight</span> <span class="o">=</span> <span class="nf">bitwiseExtract</span><span class="p">(</span><span class="nx">qcNight</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">).</span><span class="nf">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">maskNight</span> <span class="o">=</span> <span class="nx">qaMaskNight</span><span class="p">.</span><span class="nf">and</span><span class="p">(</span><span class="nx">dataQualityMaskNight</span><span class="p">).</span><span class="nf">and</span><span class="p">(</span><span class="nx">lstErrorMaskNight</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">lstNightMasked</span> <span class="o">=</span> <span class="nx">lstNight</span><span class="p">.</span><span class="nf">updateMask</span><span class="p">(</span><span class="nx">maskNight</span><span class="p">);</span>

  <span class="c1">// Add the masked bands back to the image</span>
  <span class="k">return</span> <span class="nx">image</span><span class="p">.</span><span class="nf">addBands</span><span class="p">([</span><span class="nx">lstDayMasked</span><span class="p">.</span><span class="nf">rename</span><span class="p">(</span><span class="dl">'</span><span class="s1">LST_Day_Masked</span><span class="dl">'</span><span class="p">),</span> <span class="nx">lstNightMasked</span><span class="p">.</span><span class="nf">rename</span><span class="p">(</span><span class="dl">'</span><span class="s1">LST_Night_Masked</span><span class="dl">'</span><span class="p">)],</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">LST_Masked</span> <span class="o">=</span> <span class="nx">LST_scaled</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="nx">applyQaMask</span><span class="p">);</span>
</code></pre></div></div> <h3 id="plotting-the-chart">Plotting the Chart</h3> <p>Finally, we run the following code to create a time series chart. You can modify the reducer to use other descriptive statistics such as max, min, median, etc.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">chart</span> <span class="o">=</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">Chart</span><span class="p">.</span><span class="nx">image</span><span class="p">.</span><span class="nf">series</span><span class="p">({</span>
<span class="na">imageCollection</span><span class="p">:</span> <span class="nx">LST_Masked</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">LST_Day_Masked</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">LST_Night_Masked</span><span class="dl">'</span><span class="p">),</span>
<span class="na">region</span><span class="p">:</span> <span class="nx">aoi</span><span class="p">,</span>
<span class="na">reducer</span><span class="p">:</span> <span class="nx">ee</span><span class="p">.</span><span class="nx">Reducer</span><span class="p">.</span><span class="nf">mean</span><span class="p">(),</span>
<span class="na">scale</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
<span class="na">xProperty</span><span class="p">:</span> <span class="dl">'</span><span class="s1">system:time_start</span><span class="dl">'</span>
<span class="p">})</span>
<span class="p">.</span><span class="nf">setSeriesNames</span><span class="p">([</span><span class="dl">'</span><span class="s1">LST_Day_1km</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">LST_Night_1km</span><span class="dl">'</span><span class="p">])</span>
<span class="p">.</span><span class="nf">setOptions</span><span class="p">({</span>
<span class="na">title</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Stockton Mean Surface Temperature in 2013-2023</span><span class="dl">'</span><span class="p">,</span>
<span class="na">hAxis</span><span class="p">:</span> <span class="p">{</span><span class="na">title</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Date</span><span class="dl">'</span><span class="p">,</span> <span class="na">titleTextStyle</span><span class="p">:</span> <span class="p">{</span><span class="na">italic</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">bold</span><span class="p">:</span> <span class="kc">true</span><span class="p">}},</span>
<span class="na">vAxis</span><span class="p">:</span> <span class="p">{</span><span class="na">title</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Surface Temperature</span><span class="dl">'</span><span class="p">,</span> <span class="na">titleTextStyle</span><span class="p">:</span> <span class="p">{</span><span class="na">italic</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">bold</span><span class="p">:</span> <span class="kc">true</span><span class="p">}},</span>
<span class="na">lineWidth</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span>
<span class="na">colors</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">ED254E</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">465362</span><span class="dl">'</span><span class="p">],</span> <span class="c1">//change the color as you like</span>
<span class="na">curveType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">function</span><span class="dl">'</span><span class="p">,</span>
<span class="na">interpolateNulls</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">});</span>

<span class="nf">print</span><span class="p">(</span><span class="nx">chart</span><span class="p">)</span>
</code></pre></div></div> <h3 id="final-result">Final Result</h3> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/timeSeries-480.webp 480w,/assets/img/timeSeries-800.webp 800w,/assets/img/timeSeries-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/timeSeries.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div>]]></content><author><name></name></author><category term="sample-posts"/><category term="formatting"/><category term="code"/><summary type="html"><![CDATA[an example of a blog post with some code]]></summary></entry></feed>